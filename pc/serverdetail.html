<!doctype html>
<html lang="{{ current }}">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>{{ server[2] }}</title><link rel="stylesheet" href="/pc/style.css"></head>
<body>
<main class="wrap">
<header class="sidebar"><a href="/servers" data-nav="soft" class="profilebadge"><img src="{{ '/media/' + server[3] if server[3] else '/pc/avatar.svg' }}" class="avatar" alt="avatar"><span>{{ server[2] }}</span></a><nav class="topnav"><button type="button" class="linkbtn" data-go-back="1">{{ t.get("back","Back") }}</button><a href="/servers" data-nav="soft" class="linkbtn">{{ t.get("servers","Servers") }}</a></nav></header>

{% if canmanageroles %}
<section class="panel">
<h2>Rol Oluştur</h2>
<form method="post" action="/servers/{{ server[0] }}/roles/create" data-nav="soft" class="form">
<input name="name" type="text" placeholder="Rol adı" required>
<label><input type="checkbox" name="perm_invitelink" value="1"> Davet linki oluşturma</label>
<label><input type="checkbox" name="perm_managechannels" value="1"> Kanal/kategori yönetimi</label>
<label><input type="checkbox" name="perm_deleteothers" value="1"> Başkasının mesajını silme</label>
<label><input type="checkbox" name="perm_kick" value="1"> Kick</label>
<label><input type="checkbox" name="perm_ban" value="1"> Ban</label>
<label><input type="checkbox" name="perm_timeout" value="1"> Timeout</label>
<label><input type="checkbox" name="perm_voiceban" value="1"> Sesli kanal yasağı</label>
<label><input type="checkbox" name="perm_voicetimeout" value="1"> Sesli timeout</label>
<label><input type="checkbox" name="perm_unkick" value="1"> Kick kaldır</label>
<label><input type="checkbox" name="perm_unban" value="1"> Ban kaldır</label>
<label><input type="checkbox" name="perm_untimeout" value="1"> Timeout kaldır</label>
<label><input type="checkbox" name="perm_manageroles" value="1"> Rol yönetimi</label>
<button class="pickbtn" type="submit">Rol kaydet</button>
</form>
</section>
{% endif %}

<section class="panel">
<h2>Roller</h2>
{% for r in roles %}
<div class="cardrow"><div class="who">{{ r[1] }}</div><div class="acts">
{% if canmanageroles %}
<form method="post" action="/servers/{{ server[0] }}/roles/{{ r[0] }}/edit" data-nav="soft" class="form">
<input name="name" type="text" value="{{ r[1] }}">
<button class="linkbtn">Güncelle</button>
</form>
{% endif %}
</div></div>
{% endfor %}
</section>

{% if canmanageroles %}
<section class="panel">
<h2>Üye Rolleri</h2>
{% for m in members %}
<div class="cardrow"><div class="who"><img src="{{ m.avatar }}" class="avatar sm" alt="a"> {{ m.username }}</div><div class="acts"><form method="post" action="/servers/{{ server[0] }}/members/{{ m.id }}/role" data-nav="soft"><select name="roleid"><option value="0">Varsayılan</option>{% for r in roles %}<option value="{{ r[0] }}" {% if m.roleid == r[0] %}selected{% endif %}>{{ r[1] }}</option>{% endfor %}</select><button class="linkbtn">Ata</button></form></div></div>
{% endfor %}
</section>
{% endif %}

{% if canmanagechannels %}
<section class="panel">
<h2>Kategori Oluştur</h2>
<form method="post" action="/servers/{{ server[0] }}/categories/create" data-nav="soft" class="form">
<input name="name" type="text" placeholder="Kategori adı" required>
<select name="kind"><option value="text">Mesajlaşma</option><option value="voice">Sesli</option></select>
<button class="pickbtn">Oluştur</button>
</form>
</section>

<section class="panel">
<h2>Kanal Oluştur</h2>
<form method="post" action="/servers/{{ server[0] }}/channels/create" data-nav="soft" class="form">
<input name="name" type="text" placeholder="Kanal adı" required>
<select name="categoryid"><option value="0">Kategorisiz</option>{% for c in categories %}<option value="{{ c[0] }}">{{ c[1] }}</option>{% endfor %}</select>
<select name="kind"><option value="text">Mesaj</option><option value="voice">Sesli</option></select>
<select name="contentmode"><option value="all">Tümü</option><option value="image">Sadece görsel</option><option value="video">Sadece video</option><option value="audio">Sadece ses</option></select>
<label>Görebilecek roller</label>{% for r in roles %}<label><input type="checkbox" name="visibleperms" value="{{ r[0] }}"> {{ r[1] }}</label>{% endfor %}
<label>Yazabilecek roller</label>{% for r in roles %}<label><input type="checkbox" name="writeperms" value="{{ r[0] }}"> {{ r[1] }}</label>{% endfor %}
<label>Paylaşabilecek roller</label>{% for r in roles %}<label><input type="checkbox" name="shareperms" value="{{ r[0] }}"> {{ r[1] }}</label>{% endfor %}
<button class="pickbtn">Kanal kaydet</button>
</form>
</section>
{% endif %}

<section class="panel">
<h2>Kategoriler ve Kanallar</h2>
{% for c in categories %}
<div class="cardrow"><div class="who"><strong>{{ c[1] }}</strong> ({{ c[2] }})</div>
<div class="acts">
{% if canmanagechannels %}
<form method="post" action="/servers/{{ server[0] }}/categories/{{ c[0] }}/edit" data-nav="soft"><input name="name" value="{{ c[1] }}"><select name="kind"><option value="text" {% if c[2]=='text' %}selected{% endif %}>Mesaj</option><option value="voice" {% if c[2]=='voice' %}selected{% endif %}>Sesli</option></select><button class="linkbtn">Güncelle</button></form>
{% endif %}
</div></div>
{% for ch in channels %}
{% if ch[1] == c[0] %}
<div class="cardrow"><div class="who">{% if ch[3] == 'voice' %}<a href="/servers/{{ server[0] }}/voice/{{ ch[0] }}" data-nav="soft" class="linkbtn"># {{ ch[2] }}</a>{% else %}<a href="/servers/{{ server[0] }}/channels/{{ ch[0] }}" data-nav="soft" class="linkbtn"># {{ ch[2] }}</a>{% endif %} ({{ ch[3] }}, {{ ch[4] }})</div>
<div class="acts">
{% if canmanagechannels %}
<form method="post" action="/servers/{{ server[0] }}/channels/{{ ch[0] }}/edit" data-nav="soft" class="form"><input type="hidden" name="categoryid" value="{{ ch[1] }}"><input name="name" value="{{ ch[2] }}"><select name="kind"><option value="text" {% if ch[3]=='text' %}selected{% endif %}>Mesaj</option><option value="voice" {% if ch[3]=='voice' %}selected{% endif %}>Sesli</option></select><select name="contentmode"><option value="all" {% if ch[4]=='all' %}selected{% endif %}>Tümü</option><option value="image" {% if ch[4]=='image' %}selected{% endif %}>Görsel</option><option value="video" {% if ch[4]=='video' %}selected{% endif %}>Video</option><option value="audio" {% if ch[4]=='audio' %}selected{% endif %}>Ses</option></select><button class="linkbtn">Güncelle</button></form>
{% endif %}
</div></div>
{% endif %}
{% endfor %}
{% endfor %}
</section>

<section class="panel">
<h2>{{ t.get("joinrequests","Join requests") }}</h2>
{% for p in pending %}
<div class="cardrow"><div class="who"><img src="{{ p.avatar }}" class="avatar sm" alt="a"> {{ p.username }}</div><div class="acts"><form method="post" action="/servers/accept/{{ p.joinid }}" data-nav="soft"><button class="pickbtn">{{ t.get("accept","Accept") }}</button></form><form method="post" action="/servers/reject/{{ p.joinid }}" data-nav="soft"><button class="linkbtn">{{ t.get("reject","Reject") }}</button></form></div></div>
{% else %}<p>{{ t.get("norequests","No requests") }}</p>{% endfor %}
</section>
</main>
<script src="/pc/app.js?v=3"></script>
</body>
</html>
