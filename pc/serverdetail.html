<!doctype html>
<html lang="{{ current }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ server[2] }} - Euphorium</title>
    <link rel="stylesheet" href="/pc/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* === Premium Sunucu Yönetim & Görüntüleme Paneli === */
        
        body { position: relative; background-color: var(--bg); overflow-x: hidden; min-height: 100vh; padding-top: 0; }
        
        /* Arka Plan ve Işıklar */
        .bg-texture { position: fixed; inset: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E"); pointer-events: none; z-index: -1; opacity: 0.5; }
        .ambient-orb { position: fixed; border-radius: 50%; filter: blur(100px); z-index: -2; opacity: 0.3; will-change: transform; }
        .orb-1 { width: 45vw; height: 45vw; background: var(--primary); top: -10%; left: -10%; animation: driftPrimary 30s ease-in-out infinite alternate; }
        .orb-2 { width: 40vw; height: 40vw; background: #818cf8; bottom: -10%; right: -10%; animation: driftPurple 25s ease-in-out infinite alternate; }
        
        @keyframes driftPrimary { 0% { transform: translate(0, 0) scale(1); } 100% { transform: translate(10vw, 10vh) scale(1.1); } }
        @keyframes driftPurple { 0% { transform: translate(0, 0) scale(1); } 100% { transform: translate(-10vw, -10vh) scale(1.2); } }

        .side-rail {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 85px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 14px;
            padding: 16px 0;
            background: rgba(var(--panel-rgb), 0.5);
            backdrop-filter: blur(18px);
            border-right: 1px solid rgba(var(--line-rgb), 0.6);
            z-index: 1000;
        }
        .rail-btn { width: 52px; height: 52px; border-radius: 16px; display: grid; place-items: center; border: 1px solid rgba(var(--line-rgb), 0.7); color: var(--text); background: rgba(var(--bg-rgb), 0.4); transition: all 0.2s; text-decoration: none; }
        .rail-btn:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-1px); }
        .rail-divider { width: 40px; height: 2px; background: rgba(var(--text-rgb), 0.12); border-radius: 2px; margin: 2px 0; }

        /* Ana Konteyner */
        .server-wrap { max-width: 1200px; margin: 0 auto; margin-left: 95px; padding: 30px 20px 60px 20px; display: flex; flex-direction: column; gap: 24px; }
        
        /* Ortak Panel Stili */
        .panel { 
            background: rgba(var(--panel-rgb), 0.7) !important; 
            backdrop-filter: blur(24px) !important; 
            -webkit-backdrop-filter: blur(24px) !important; 
            border: 1px solid rgba(255, 255, 255, 0.08) !important; 
            border-radius: 20px !important; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05) !important; 
            padding: 30px !important; 
            animation: slideUpFade 0.5s ease forwards; 
        }
        body[data-theme="dark"] .panel { box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3) !important; border: 1px solid rgba(255, 255, 255, 0.04) !important; }
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .panel-title { display: flex; align-items: center; gap: 10px; font-size: 1.3rem; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(var(--text-rgb), 0.05); }
        .panel-title i { color: var(--primary); }

        /* --- HERO: Sunucu Başlığı --- */
        .server-hero { padding: 0 !important; overflow: hidden; display: flex; flex-direction: column; }
        .server-banner { height: 140px; background: linear-gradient(135deg, var(--primary), #818cf8); position: relative; }
        .server-banner::after { content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.2); }
        .server-hero-content { padding: 0 30px 30px 30px; display: flex; align-items: flex-end; gap: 20px; margin-top: -50px; position: relative; z-index: 2; }
        .server-hero-content img { width: 110px; height: 110px; border-radius: 24px; border: 4px solid var(--panel); object-fit: cover; background: var(--panel); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .server-hero-text h1 { font-size: 2.2rem; margin: 0 0 5px 0; color: var(--text); }
        .server-hero-text p { margin: 0; color: var(--muted); font-size: 1.05rem; }

        /* --- KANAL TARAYICISI (Public Browser) --- */
        .category-block { background: rgba(var(--bg-rgb), 0.3); border: 1px solid rgba(var(--line-rgb), 0.5); border-radius: 16px; margin-bottom: 20px; overflow: hidden; }
        .category-header { background: rgba(var(--bg-rgb), 0.6); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(var(--line-rgb), 0.5); font-weight: 700; font-size: 1.05rem; color: var(--primary); text-transform: uppercase; letter-spacing: 0.5px; }
        .channel-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; padding: 20px; }
        
        .channel-item { background: rgba(var(--panel-rgb), 0.6); border: 1px solid rgba(var(--line-rgb), 0.4); border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; align-items: center; text-decoration: none; color: var(--text); transition: all 0.2s; }
        .channel-item:hover { border-color: var(--primary); background: rgba(var(--primary-rgb), 0.1); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(var(--primary-rgb), 0.1); }
        .chan-info { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 1.05rem; }
        .chan-info i { color: var(--muted); transition: color 0.2s; }
        .channel-item:hover .chan-info i { color: var(--primary); }
        
        .badge { font-size: 0.7rem; background: rgba(var(--text-rgb), 0.1); color: var(--text); padding: 4px 10px; border-radius: 20px; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; }
        .badge.primary { background: rgba(var(--primary-rgb), 0.2); color: var(--primary); }

        /* --- SEKME (TAB) SİSTEMİ --- */
        .admin-tabs { display: flex; border-bottom: 1px solid rgba(var(--line-rgb), 0.5); margin-bottom: 25px; overflow-x: auto; gap: 10px; padding-bottom: 10px; }
        .admin-tabs::-webkit-scrollbar { height: 4px; } .admin-tabs::-webkit-scrollbar-thumb { background: var(--line); border-radius: 4px; }
        .tab-btn { background: transparent; border: none; border-bottom: 3px solid transparent; color: var(--muted); padding: 10px 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 1.05rem; font-family: var(--font-primary); white-space: nowrap; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-btn:hover:not(.active) { color: var(--text); border-bottom-color: var(--line); }
        
        .admin-tab-content { display: none; animation: fadeIn 0.3s ease; }
        .admin-tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- YÖNETİCİ FORMLARI --- */
        .admin-card { background: rgba(var(--bg-rgb), 0.4); border: 1px dashed rgba(var(--line-rgb), 0.8); border-radius: 16px; padding: 20px; margin-bottom: 20px; }
        .admin-card h3 { margin: 0 0 15px 0; font-size: 1.1rem; color: var(--text); display: flex; align-items: center; gap: 8px; }
        
        .form-row { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 15px; }
        .form-row > * { flex: 1; min-width: 150px; }
        
        input[type="text"], select { background: rgba(var(--bg-rgb), 0.5); border: 1px solid rgba(var(--line-rgb), 0.8); border-radius: 10px; padding: 12px 15px; color: var(--text); outline: none; transition: border 0.3s; font-family: var(--font-primary); }
        input[type="text"]:focus, select:focus { border-color: var(--primary); }
        select option { background: var(--panel); color: var(--text); }
        
        .perm-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; background: rgba(var(--bg-rgb), 0.3); padding: 15px; border-radius: 12px; border: 1px solid rgba(var(--line-rgb), 0.3); margin-bottom: 15px; }
        .perm-grid label { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer; color: var(--text); }
        .perm-grid input[type="checkbox"] { accent-color: var(--primary); width: 16px; height: 16px; }

        .inline-edit-form { display: flex; gap: 10px; align-items: center; background: rgba(var(--bg-rgb), 0.5); padding: 12px; border-radius: 12px; border: 1px solid rgba(var(--line-rgb), 0.5); margin-bottom: 10px; flex-wrap: wrap; }
        .inline-edit-form > * { flex: 1; min-width: 120px; }
        .inline-edit-form button { flex: 0 0 auto; padding: 12px 20px; border-radius: 10px; border: none; background: var(--line); color: var(--text); font-weight: 600; cursor: pointer; transition: 0.2s; }
        .inline-edit-form button:hover { background: var(--primary); color: #fff; }

        /* Kullanıcı Kartları (İstekler ve Üyeler İçin) */
        .modern-user-card { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(var(--bg-rgb), 0.4); border: 1px solid rgba(var(--line-rgb), 0.5); border-radius: 14px; margin-bottom: 10px; }
        .modern-user-card .who { display: flex; align-items: center; gap: 12px; font-weight: 600; }
        .modern-user-card .who img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; }
        
        .empty-state { text-align: center; padding: 40px 20px; color: var(--muted); background: rgba(var(--bg-rgb), 0.2); border-radius: 16px; border: 1px dashed rgba(var(--line-rgb), 0.6); }
        .empty-state i { font-size: 3rem; margin-bottom: 15px; opacity: 0.5; color: var(--primary); }

        @media(max-width: 768px) { 
            .side-rail { position: static; width: 100%; height: auto; flex-direction: row; justify-content: flex-start; padding: 12px; border-right: none; border-bottom: 1px solid rgba(var(--line-rgb), 0.6); }
            .server-wrap { margin-left: 0; padding-top: 20px; }
            .server-hero-content { flex-direction: column; align-items: center; text-align: center; } 
            .channel-list { grid-template-columns: 1fr; } 
            .modern-user-card { flex-direction: column; gap: 15px; align-items: flex-start; } 
            .modern-user-card form, .modern-user-card button { width: 100%; } 
            .inline-edit-form > * { flex: 100%; }
        }
    </style>
</head>
<body>
    <div class="bg-texture"></div>
    <div class="ambient-orb orb-1"></div>
    <div class="ambient-orb orb-2"></div>

    <aside class="side-rail">
        <a class="rail-btn" href="/" data-nav="soft" title="{{ t.get('home','Home') }}"><i class="fa-solid fa-house"></i></a>
        <a class="rail-btn" href="/dm" data-nav="soft" title="{{ t.get('dm','DM') }}"><i class="fa-solid fa-paper-plane"></i></a>
        <a class="rail-btn" href="/servers" data-nav="soft" title="{{ t.get('servers','Servers') }}"><i class="fa-solid fa-server"></i></a>
        <div class="rail-divider"></div>
        <button type="button" class="rail-btn" data-go-back="1" title="Back"><i class="fa-solid fa-arrow-left"></i></button>
        <div style="flex:1;"></div>
        <button class="profile-btn rail-btn" id="profileBtn" style="padding:0;">
            <img src="{{ avatar }}" class="avatar" alt="avatar" style="width:42px;height:42px;">
        </button>
    </aside>

    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="lang-switcher">
                <button data-theme-set="light" class='navbtn'><i class="fa-solid fa-sun"></i></button>
                <button data-theme-set="dark" class='navbtn'><i class="fa-solid fa-moon"></i></button>
            </div>
            <a href="/settings" data-nav="soft" class="modal-link"><i class="fa-solid fa-cog"></i><span>{{ t.get("settings", "Settings") }}</span></a>
            <a href="/logout" data-nav="soft" class="modal-link"><i class="fa-solid fa-right-from-bracket"></i><span>{{ t.get("logout", "Logout") }}</span></a>
        </div>
    </div>

    <main class="wrap server-wrap">

        <section class="panel server-hero">
            <div class="server-banner"></div>
            <div class="server-hero-content">
                <img src="{{ '/media/' + server[3] if server[3] else '/pc/avatar.svg' }}" alt="avatar">
                <div class="server-hero-text">
                    <h1>{{ server[2] }}</h1>
                    <p>Sunucu portalına hoş geldiniz. Kanallara göz atın ve sohbete katılın.</p>
                </div>
            </div>
        </section>

        <section class="panel">
            <h2 class="panel-title"><i class="fa-solid fa-list-ul"></i> Sunucu Kanalları</h2>
            {% for c in categories %}
            <div class="category-block">
                <div class="category-header">
                    <span><i class="fa-regular fa-folder-open"></i> {{ c[1] }}</span>
                    <span class="badge">{{ c[2] }}</span>
                </div>
                <div class="channel-list">
                    {% for ch in channels %}
                        {% if ch[1] == c[0] %}
                        <a href="/servers/{{ server[0] }}/{{ 'voice' if ch[3] == 'voice' else 'channels' }}/{{ ch[0] }}" data-nav="soft" class="channel-item">
                            <div class="chan-info">
                                <i class="fa-solid {{ 'fa-volume-high' if ch[3] == 'voice' else 'fa-hashtag' }}"></i>
                                <span>{{ ch[2] }}</span>
                            </div>
                            <div style="display:flex; gap:5px;">
                                <span class="badge primary">{{ ch[3] }}</span>
                                <span class="badge">{{ ch[4] }}</span>
                            </div>
                        </a>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </section>

        {% if canmanageroles or canmanagechannels or pending %}
        <section class="panel">
            <h2 class="panel-title"><i class="fa-solid fa-screwdriver-wrench"></i> Yönetici Paneli</h2>
            
            <div class="admin-tabs">
                {% if pending %}
                    <button class="tab-btn" data-target="tab-req" onclick="switchAdminTab('tab-req')">Katılım İstekleri <span class="badge primary">{{ pending|length }}</span></button>
                {% endif %}
                {% if canmanagechannels %}
                    <button class="tab-btn" data-target="tab-chan" onclick="switchAdminTab('tab-chan')">Kanal ve Kategori</button>
                {% endif %}
                {% if canmanageroles %}
                    <button class="tab-btn" data-target="tab-roles" onclick="switchAdminTab('tab-roles')">Rol Yönetimi</button>
                    <button class="tab-btn" data-target="tab-members" onclick="switchAdminTab('tab-members')">Üyeler</button>
                {% endif %}
            </div>

            {% if pending %}
            <div id="tab-req" class="admin-tab-content">
                {% for p in pending %}
                <div class="modern-user-card">
                    <div class="who"><img src="{{ p.avatar }}" alt="a"> {{ p.username }}</div>
                    <div style="display:flex; gap:10px;">
                        <form method="post" action="/servers/accept/{{ p.joinid }}" data-nav="soft"><button class="pickbtn" style="padding:10px 15px;"><i class="fa-solid fa-check"></i> Kabul Et</button></form>
                        <form method="post" action="/servers/reject/{{ p.joinid }}" data-nav="soft"><button class="linkbtn" style="padding:10px 15px; border-color:#ef4444; color:#ef4444;"><i class="fa-solid fa-xmark"></i> Reddet</button></form>
                    </div>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fa-solid fa-inbox"></i>
                    <span>{{ t.get("norequests","No requests") }}</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% if canmanagechannels %}
            <div id="tab-chan" class="admin-tab-content">
                <div class="admin-card">
                    <h3><i class="fa-solid fa-folder-plus"></i> Kategori Oluştur</h3>
                    <form method="post" action="/servers/{{ server[0] }}/categories/create" data-nav="soft" class="form-row">
                        <input name="name" type="text" placeholder="Kategori adı" required>
                        <select name="kind">
                            <option value="text">Mesajlaşma</option>
                            <option value="voice">Sesli</option>
                        </select>
                        <button class="pickbtn"><i class="fa-solid fa-plus"></i> Oluştur</button>
                    </form>
                </div>

                <div class="admin-card">
                    <h3><i class="fa-solid fa-satellite-dish"></i> Kanal Oluştur</h3>
                    <form method="post" action="/servers/{{ server[0] }}/channels/create" data-nav="soft">
                        <div class="form-row">
                            <input name="name" type="text" placeholder="Kanal adı" required>
                            <select name="categoryid">
                                <option value="0">Kategorisiz</option>
                                {% for c in categories %}<option value="{{ c[0] }}">{{ c[1] }}</option>{% endfor %}
                            </select>
                            <select name="kind">
                                <option value="text">Mesaj</option>
                                <option value="voice">Sesli</option>
                            </select>
                            <select name="contentmode">
                                <option value="all">Tümü</option>
                                <option value="image">Sadece görsel</option>
                                <option value="video">Sadece video</option>
                                <option value="audio">Sadece ses</option>
                            </select>
                        </div>
                        
                        <div class="perm-grid">
                            <div style="font-weight:600; grid-column:1/-1; color:var(--primary);">Görebilecek Roller</div>
                            {% for r in roles %}<label><input type="checkbox" name="visibleperms" value="{{ r[0] }}"> {{ r[1] }}</label>{% endfor %}
                        </div>
                        <div class="perm-grid">
                            <div style="font-weight:600; grid-column:1/-1; color:var(--primary);">Yazabilecek Roller</div>
                            {% for r in roles %}<label><input type="checkbox" name="writeperms" value="{{ r[0] }}"> {{ r[1] }}</label>{% endfor %}
                        </div>
                        <div class="perm-grid">
                            <div style="font-weight:600; grid-column:1/-1; color:var(--primary);">Paylaşabilecek Roller</div>
                            {% for r in roles %}<label><input type="checkbox" name="shareperms" value="{{ r[0] }}"> {{ r[1] }}</label>{% endfor %}
                        </div>
                        <button class="pickbtn" style="width:100%;"><i class="fa-solid fa-floppy-disk"></i> Kanal Kaydet</button>
                    </form>
                </div>

                <div class="admin-card">
                    <h3><i class="fa-solid fa-pen-to-square"></i> Mevcutları Düzenle</h3>
                    {% for c in categories %}
                        <div style="margin-bottom: 25px;">
                            <form method="post" action="/servers/{{ server[0] }}/categories/{{ c[0] }}/edit" data-nav="soft" class="inline-edit-form" style="background: rgba(var(--primary-rgb), 0.1); border-color: var(--primary);">
                                <span style="font-weight:bold; color:var(--primary);"><i class="fa-solid fa-folder"></i> Kategori:</span>
                                <input name="name" value="{{ c[1] }}">
                                <select name="kind">
                                    <option value="text" {% if c[2]=='text' %}selected{% endif %}>Mesaj</option>
                                    <option value="voice" {% if c[2]=='voice' %}selected{% endif %}>Sesli</option>
                                </select>
                                <button type="submit">Güncelle</button>
                            </form>
                            
                            <div style="padding-left: 30px; border-left: 2px solid rgba(var(--primary-rgb), 0.3); margin-top: 10px;">
                                {% for ch in channels %}
                                    {% if ch[1] == c[0] %}
                                    <form method="post" action="/servers/{{ server[0] }}/channels/{{ ch[0] }}/edit" data-nav="soft" class="inline-edit-form">
                                        <span style="font-weight:bold; color:var(--muted);"><i class="fa-solid fa-hashtag"></i> Kanal:</span>
                                        <input type="hidden" name="categoryid" value="{{ ch[1] }}">
                                        <input name="name" value="{{ ch[2] }}">
                                        <select name="kind">
                                            <option value="text" {% if ch[3]=='text' %}selected{% endif %}>Mesaj</option>
                                            <option value="voice" {% if ch[3]=='voice' %}selected{% endif %}>Sesli</option>
                                        </select>
                                        <select name="contentmode">
                                            <option value="all" {% if ch[4]=='all' %}selected{% endif %}>Tümü</option>
                                            <option value="image" {% if ch[4]=='image' %}selected{% endif %}>Görsel</option>
                                            <option value="video" {% if ch[4]=='video' %}selected{% endif %}>Video</option>
                                            <option value="audio" {% if ch[4]=='audio' %}selected{% endif %}>Ses</option>
                                        </select>
                                        <button type="submit">Güncelle</button>
                                    </form>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if canmanageroles %}
            <div id="tab-roles" class="admin-tab-content">
                <div class="admin-card">
                    <h3><i class="fa-solid fa-shield-plus"></i> Rol Oluştur</h3>
                    <form method="post" action="/servers/{{ server[0] }}/roles/create" data-nav="soft">
                        <input name="name" type="text" placeholder="Rol adı" required style="width:100%; margin-bottom:15px;">
                        <div class="perm-grid">
                            <label><input type="checkbox" name="perm_invitelink" value="1"> Davet linki oluşturma</label>
                            <label><input type="checkbox" name="perm_managechannels" value="1"> Kanal/kategori yönetimi</label>
                            <label><input type="checkbox" name="perm_deleteothers" value="1"> Başkasının mesajını silme</label>
                            <label><input type="checkbox" name="perm_kick" value="1"> Sunucudan At (Kick)</label>
                            <label><input type="checkbox" name="perm_ban" value="1"> Yasakla (Ban)</label>
                            <label><input type="checkbox" name="perm_timeout" value="1"> Sustur (Timeout)</label>
                            <label><input type="checkbox" name="perm_voiceban" value="1"> Sesli kanal yasağı</label>
                            <label><input type="checkbox" name="perm_voicetimeout" value="1"> Sesli timeout</label>
                            <label><input type="checkbox" name="perm_unkick" value="1"> Kick kaldır</label>
                            <label><input type="checkbox" name="perm_unban" value="1"> Ban kaldır</label>
                            <label><input type="checkbox" name="perm_untimeout" value="1"> Timeout kaldır</label>
                            <label><input type="checkbox" name="perm_manageroles" value="1"> Rol yönetimi</label>
                        </div>
                        <button class="pickbtn" type="submit" style="width:100%;"><i class="fa-solid fa-floppy-disk"></i> Rol Kaydet</button>
                    </form>
                </div>

                <div class="admin-card">
                    <h3><i class="fa-solid fa-tags"></i> Mevcut Roller</h3>
                    {% for r in roles %}
                    <form method="post" action="/servers/{{ server[0] }}/roles/{{ r[0] }}/edit" data-nav="soft" class="inline-edit-form">
                        <span style="font-weight:bold; color:var(--primary);"><i class="fa-solid fa-circle" style="font-size:0.6rem;"></i> Rol:</span>
                        <input name="name" type="text" value="{{ r[1] }}">
                        <button type="submit">Güncelle</button>
                    </form>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if canmanageroles %}
            <div id="tab-members" class="admin-tab-content">
                <div class="admin-card">
                    <h3><i class="fa-solid fa-users-gear"></i> Üye Yetkilendirme</h3>
                    {% for m in members %}
                    <div class="modern-user-card">
                        <div class="who"><img src="{{ m.avatar }}" alt="a"> {{ m.username }}</div>
                        <form method="post" action="/servers/{{ server[0] }}/members/{{ m.id }}/role" data-nav="soft" style="display:flex; gap:10px; align-items:center;">
                            <select name="roleid" style="padding:10px; min-width:150px;">
                                <option value="0">Varsayılan Üye</option>
                                {% for r in roles %}
                                <option value="{{ r[0] }}" {% if m.roleid == r[0] %}selected{% endif %}>{{ r[1] }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="pickbtn" style="padding:10px 20px;"><i class="fa-solid fa-check"></i> Ata</button>
                        </form>
                    </div>
                    {% else %}
                    <p style="color:var(--muted); text-align:center;">Henüz üye yok.</p>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

        </section>
        {% endif %}
    </main>

    <script src="/pc/app.js?v=3"></script>
    <script>
        // Sekme (Tab) Değiştirme Sistemi (SPA yapısına uygun)
        window.switchAdminTab = function(tabId) {
            document.querySelectorAll('.admin-tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            const target = document.getElementById(tabId);
            if(target) target.classList.add('active');
            
            const btn = document.querySelector(`.tab-btn[data-target="${tabId}"]`);
            if(btn) btn.classList.add('active');
        };

        // Sayfa yüklendiğinde mevcut ilk sekmeyi otomatik aç
        (function initFirstTab() {
            const firstBtn = document.querySelector('.tab-btn');
            if(firstBtn) {
                const targetId = firstBtn.getAttribute('data-target');
                switchAdminTab(targetId);
            }
        })();
    </script>
</body>
</html>
