<!doctype html>
<html lang="{{ current }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Kasalar - Euphorium</title>
  <link rel="stylesheet" href="/mobile/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .case-home { max-width: 1100px; margin: 0 auto; padding: 8px 12px 12px; }
    .top { display:flex; align-items:center; justify-content:space-between; margin-bottom: 6px; }
    .top h1 { margin: 0; font-size: 1.15rem; line-height: 1.1; }
    .grid { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 8px; }
    .card { background: transparent; border: none; border-radius: 0; padding: 0; text-decoration:none; color:var(--text); display:flex; flex-direction:column; align-items:center; }
    .cover { width: 100%; aspect-ratio: 1 / 1; background: transparent; display:grid; place-items:center; margin-bottom:2px; overflow:visible; }
    .cover img { width: 100%; height: 100%; object-fit: contain; display:block; transition: filter 0.2s ease; }
    .card:hover .cover img { filter: brightness(1.18); }
    .cover i { display: none; }
    .cover.noimg i { display: block; }
    .price { color: #f59e0b; margin-top: 0; font-weight: 800; font-size: 0.82rem; position: relative; top: -16px; }
    @media (max-width: 900px) {
      .case-home { padding-top: 6px; }
      .grid { grid-template-columns: repeat(3, minmax(0,1fr)); gap: 8px; }
    }
    @media (max-width: 640px) {
      .top { margin-bottom: 4px; }
      .top h1 { font-size: 1.05rem; }
      .grid { grid-template-columns: repeat(3, minmax(0,1fr)); gap: 6px; }
      .price { top: -12px; font-size: 0.76rem; }
      .linkbtn { padding: 7px 10px; font-size: 0.78rem; }
    }
    @media (max-width: 420px) {
      .grid { grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
  </style>

<!-- Mobile hardening patch -->
<style id="mobile-hardening-patch">
:root{
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --app-vh: 100dvh;
}
html{
  width:100%;
  max-width:100%;
  overflow-x: clip;
  -webkit-text-size-adjust:100%;
  text-size-adjust:100%;
}
body{
  width:100%;
  max-width:100%;
  min-height:100vh;
  min-height:100svh;
  min-height:100dvh;
  min-height:var(--app-vh);
  overflow-x: clip !important;
  padding-left:max(0px, var(--safe-left));
  padding-right:max(0px, var(--safe-right));
  overscroll-behavior-y: contain;
  -webkit-overflow-scrolling: touch;
}
*,*::before,*::after{ box-sizing:border-box; min-width:0; }
img,video,canvas,svg,iframe{ max-width:100%; }
input,textarea,select,button{ font:inherit; }
textarea{ max-width:100%; }

.app-header,.topbar,.header,[data-fixed="top"]{
  padding-top:max(0px, var(--safe-top));
}
.mobile-bottom-nav,.bottom-nav,.bottombar,.tabbar,[data-fixed="bottom"]{
  padding-bottom:max(0px, var(--safe-bottom));
}
.app-shell{
  min-height: var(--app-vh);
  height: var(--app-vh);
}
.app-content{
  min-height:0;
  overflow-x:hidden !important;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}
.modal,.popup,.sheet,.drawer,dialog,[role="dialog"]{
  max-height: calc(var(--app-vh) - var(--safe-top) - var(--safe-bottom) - 12px);
  max-width: min(100%, calc(100vw - 12px));
}
[style*="position: fixed"], [style*="position:fixed"],
[style*="position: sticky"], [style*="position:sticky"]{
  max-width:100vw;
}
@media (max-width:768px){
  html,body{ overflow-x:clip !important; }
  .claim-pop{
    right: 10px !important;
    left: 10px !important;
    bottom: calc(10px + var(--safe-bottom)) !important;
    width: auto !important;
  }
  .mx-wrap,.casino-wrap,.case-wrap,.case-home,.table-wrap{
    padding-left: 10px !important;
    padding-right: 10px !important;
  }
  .game-links a{ min-height: 92px; padding: 18px 12px !important; }
  .bet-controls{ flex-wrap: wrap; }
  .bet-controls .bet-input{ min-width: 100%; }
}
</style>

</head>
<body>
  <main class="case-home">
    <div class="top">
      <a href="/casino" data-nav="soft" class="linkbtn"><i class="fa-solid fa-arrow-left"></i> Casino</a>
      <h1>Kasalar</h1>
      <div></div>
    </div>
    <section id="caseGrid" class="grid"></section>
  </main>
  <script src="/mobile/js/app.js"></script>
  <script>
    (function(){
      const grid = document.getElementById('caseGrid');
      async function init(){
        const res = await fetch('/api/casino/case/state?case=afet', { headers:{'X-Requested-With':'fetch'}, cache:'no-store' });
        const data = await res.json();
        if (!res.ok || !data.ok) return;
        const cases = data.constants?.cases || [];
        grid.innerHTML = cases.map(function(c){
          return '<a class="card" href="/casino/case/' + c.id + '" data-nav="soft">' +
                 '<div class="cover"><img src="/assets/casino/case/' + c.id + '/' + c.id + 'case.png" alt="' + c.name + '" onerror="if(!this.dataset.fallback){this.dataset.fallback=\'1\';this.src=\'/assets/casino/case/' + c.id + '/felaketcase.png\';return;}this.parentElement.classList.add(\'noimg\');this.remove();"><i class="fa-solid fa-triangle-exclamation"></i></div>' +
                 '<div class="price"><i class="fa-solid fa-coins"></i> ' + Number(c.price || 0) + '</div>' +
                 '</a>';
        }).join('');
      }
      init().catch(function(){});
    })();
  </script>

<!-- Mobile hardening patch -->
<script id="mobile-hardening-script">
(function(){
  const root = document.documentElement;
  let maxVh = 0, raf = 0;
  function getVh(){
    return Math.round((window.visualViewport && window.visualViewport.height) || window.innerHeight || root.clientHeight || 0);
  }
  function apply(){
    const vh = getVh();
    if (!maxVh || vh > maxVh) maxVh = vh;
    root.style.setProperty('--app-vh', vh + 'px');
    root.classList.toggle('keyboard-open', (maxVh - vh) > 120);
  }
  function tick(){
    if (raf) cancelAnimationFrame(raf);
    raf = requestAnimationFrame(apply);
  }
  function clampWide(){
    const vw = Math.max(root.clientWidth, window.innerWidth || 0);
    if (!document.body) return;
    document.body.querySelectorAll('*').forEach(function(el){
      if (!el.getBoundingClientRect) return;
      const r = el.getBoundingClientRect();
      if (r.width > vw + 2 && !el.dataset.mobileClamp){
        el.style.maxWidth = '100%';
        if (!el.style.overflowWrap) el.style.overflowWrap = 'anywhere';
        el.dataset.mobileClamp = '1';
      }
    });
  }
  ['resize','orientationchange'].forEach(function(ev){ window.addEventListener(ev, tick, {passive:true}); });
  if (window.visualViewport){
    window.visualViewport.addEventListener('resize', tick, {passive:true});
    window.visualViewport.addEventListener('scroll', tick, {passive:true});
  }
  document.addEventListener('focusin', tick, true);
  document.addEventListener('focusout', tick, true);
  window.addEventListener('load', function(){
    tick();
    requestAnimationFrame(clampWide);
  }, {once:true});
  new MutationObserver(function(){
    tick();
    requestAnimationFrame(clampWide);
  }).observe(document.documentElement, {childList:true, subtree:true});
  apply();
})();
</script>

</body>
</html>

